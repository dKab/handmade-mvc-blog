{% extends "main.html.twig" %}

{% block title post.title %}

{% block styles %}
   {{ parent() }}
    <style type="text/css">
        .comment {
           padding-left: 5px;
        }
    </style>
{% endblock %}
{% block javascript %}
    {{ parent() }}
    <script type="text/javascript">
       $(function() {
          $('a.reply_link').click(function() {
              var toBeParent = $(this).closest('.comment').attr('id');
              $('#comment-form').find("input[name='parentId']").val(toBeParent).end().insertAfter($(this).closest('.comment'));
              return false;
          });
          $('#add_comment').click(function() {
              var pos = $('#comment-form').find("input[name='parentId']").val(null).end().appendTo('#comments').offset().top;
              $('html, body').scrollTop(pos);
              return false;
          });
       });
    </script> 
{% endblock %}

{% block content %}
                           Дата создания: 
                            {{ post.create_time }} <br />
                           {% if post.create_time != post.edit_time %}
                            Посдедний раз редактировался: 
                             {{ post.edit_time }} <br />
                           {% endif %}
    {% if user is defined %}
        Статус: {{ post.name }}
        <br />
    {% endif %}
    {% autoescape false %}
        {{ post.begining_html }}
        {{ post.ending_html }}
    {% endautoescape %}
<br />
{% if post.tags is not empty %}

                    Тэги: {% for tag in post.tags %}
                              <a href="{{ "/" ~ controller ~ "/list?tag=" ~ tag }}">{{ tag }}</a> 
                          {% endfor %}

{% endif %}

 <hr>
     {% if comments is defined and comments is not empty %}
 <span> Комментарии ({{ comments|length }}) </span> | <a href="*" id="add_comment">Комментировать</a>
          <section id='comments'>
              {% for comment in comments %}
                 {% include 'comment.html.twig' %}
              {% endfor %}
          </section>
     {% else %}
        <span> Комментариев пока нет </span> | <a href="*" id="add_comment">Комментировать</a>
     {% endif %}
        
     {% macro commentForm(header, postId, recaptcha) %}
          <form method='POST' action='/index/comment' id="comment-form">
              {{ header }} <br>
              <input type='text' name="name" style="margin-bottom: 10px;">
              <label for='name' >Имя *</label><br>
              <input type="text" name="email">
              <label for="email">Email *</label><br>
              <input type="hidden" name="postId" value="{{ postId }}">
              <input type="hidden" name="parentId" value="null">
              <label for="body">Комментарий *</label><br>
              <textarea cols="59" rows="10" name="body">
              </textarea><br>
              <input type="checkbox" name="notify" checked="checked">
              <label for="notify">Уведомлять меня по почте об ответах на мой комментарий</label><br>
              {% autoescape false %}
                  {{ recaptcha }}
              {% endautoescape %}
              <input type="submit" value="Отправить">
          </form>
     {% endmacro %}
     
     {% import _self as view %}
          
           {{ view.commentForm('Добавить комментарий', post.id, recaptcha) }}
                              
{% endblock %}
